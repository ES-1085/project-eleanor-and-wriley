---
title: "tower count data cleaning"
author: "Eleanor and Wriley"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(viridis)
library(hrbrthemes)
library(sf)
library(leaflet)
```


##FIX IMMEDIATELY THE READ EXCEL IS READING EVERY YEAR IN AS 2013

##2006

```{r 2006}
tower_count_2006 <- read_excel("data/tower_count/tower_count_2006.xls")
#in progress...getting there
#Hallie swears to me that this can be done with a for loop that runs through the species of interest so that might be a next step. She's also a lot more allergic to copy/pasting than I am
tower_count_2006 <- tower_count_2006 %>% 
  mutate(puffin = str_extract(other, "\\d*puff|\\d*.puff|\\d*atpu|\\d*.atpu|\\d*puffis|\\d*puffins|\\d*.puffins")) %>% 
  mutate(puffin = str_extract(puffin, "\\d*")) %>%
  mutate(puffin = as.double(puffin)) %>% 
  mutate(dcco = str_extract(other, "\\d*corm|\\d*dcc|\\d*dcco|\\d*ddco")) %>% 
  mutate(dcco = str_extract(dcco, "\\d*")) %>% 
  mutate(dcco = as.double(dcco)) %>% 
  mutate(ternsp = str_extract(other, "\\d*cote|\\d*.terns")) %>% 
  mutate(ternsp = str_extract(ternsp, "\\d*")) %>%
  mutate(ternsp = as.double(ternsp)) %>% 
  mutate(razo = str_extract(other, "\\d*razo|\\d*razor")) %>% 
  mutate(razo = str_extract(razo, "\\d*")) %>% 
  mutate(razo = as.double(razo)) %>%  #likewise there's gotta be a more efficient way to turn these all into doubles
  mutate(lagu = str_extract(other, "\\d*lagu")) %>% 
  mutate(lagu = str_extract(lagu, "\\d*")) %>% 
  mutate(lagu = as.double(lagu)) %>% 
  mutate(comu = str_extract(other, "\\d*murre")) %>% 
  mutate(comu = str_extract(comu, "\\d*")) %>% 
  mutate(comu = as.double(comu))

tower_count_2006 <- tower_count_2006 %>% 
  pivot_longer(cols = c(hegu, bbgu, eider, squee, puffin, dcco, ternsp, razo, lagu, comu),
             names_to = "species",
             values_to = "count")
#literally so powerful


tower_2006_clean <- tower_count_2006 %>% 
  mutate(notes = other) %>% 
  select(date, species, count, notes) %>% 
  mutate(species = case_when(species == "bbgu" ~ "gbbg",
                            species == "hegu" ~ "herg",
                            species == "eider" ~ "coei-ad",
                            species == "squee" ~ "blgu",
                            species == "puffin" ~ "atpu",
                            TRUE ~ as.character(species)))
```

```{r 2009}

tower_count_2009 <- read_excel("data/tower_count/tower_count_2009.xlsx", skip = 2)
#If we're going to do this in such an inefficient way I'm going to ask Laurie how to comment/space the code so it isn't agonizing to read
tower_count_2009 <- tower_count_2009 %>% 
#puff
  mutate(puffin = str_extract(other, "\\d*ATPU|\\d*.ATPU")) %>% 
  mutate(puffin = str_extract(puffin, "\\d*")) %>% 
  mutate(puffin = as.double(puffin)) %>% 
 #corm
  mutate(dcco = str_extract(other, "\\d*DCCO|\\d*.DCCO")) %>% 
  mutate(dcco = str_extract(dcco, "\\d*")) %>% 
  mutate(dcco = as.double(dcco)) %>%
#razo
  mutate(razo = str_extract(other, "\\d*RAZO|\\d*.RAZO")) %>% 
  mutate(razo = str_extract(razo, "\\d*")) %>% 
  mutate(razo = as.double(razo)) %>%
 #baea
  mutate(baea = str_extract(other, "\\d*BAEA|\\d*.BAEA")) %>% 
  mutate(baea = str_extract(baea, "\\d*")) %>% 
  mutate(baea = as.double(baea)) %>%
 #scoter
  mutate(scoter = str_extract(other, "\\d*.scoter")) %>% 
  mutate(scoter = str_extract(scoter, "\\d*")) %>% 
  mutate(scoter = as.double(scoter)) %>% 
#corvid
  mutate(corvid = str_extract(other, "\\d*.crow")) %>% 
  mutate(corvid = str_extract(corvid, "\\d*")) %>%
  mutate(corvid = as.double(corvid)) %>% 
#gannet
  mutate(noga = str_extract(other, "\\d*.gannet")) %>% 
  mutate(noga = str_extract(noga, "\\d*")) %>% 
  mutate(noga = as.double(noga)) %>% 
  mutate(HERG = as.double(HERG))

tower_count_2009 <- tower_count_2009 %>% 
  pivot_longer(cols = c(HERG, GBBG, BLGU, COEI, `COEI  chix`, puffin, dcco, razo, baea, scoter, corvid, noga ),
               names_to = "species",
               values_to = "count")

tower_2009_clean <- tower_count_2009 %>% 
  mutate(notes = other, date = Date) %>% 
  select(date, species, count, notes) %>% 
  mutate(species = case_when(species == "GBBG" ~ "gbbg",
                            species == "HERG" ~ "herg",
                            species == "COEI" ~ "coei_ad",
                            species == "COEI  chix" ~ "coei_ju",
                            species == "BLGU" ~ "blgu",
                            species == "puffin" ~ "atpu",
                            TRUE ~ as.character(species)))

```

```{r 2000}
tower_count_2000 <- read_excel("data/tower_count/tower_count_2000.XLS")
#will have fun times trying to break up adult and juvenile eiders



```

```{r 2001}
tower_count_2001 <- read_excel("data/tower_count/tower_count_2001.xlsx", skip = 2)

tower_count_2001 <- tower_count_2001 %>% 
  #dcco
  mutate(dcco = str_extract(notes, "\\d*DCCO|\\d*.DCCO")) %>% 
  mutate(dcco = str_extract(dcco, "\\d*")) %>% 
  mutate(dcco = as.double(dcco)) %>% 
  #atpu
  mutate(atpu= str_extract(notes, "\\d*.ALPU")) %>% 
  mutate(atpu = str_extract(atpu, "\\d*")) %>% 
  mutate(atpu = as.double(atpu)) %>% 
  #razo
  mutate(razo = str_extract(notes, "\\d*.razorbills")) %>% 
  mutate(razo = str_extract(razo, "\\d*")) %>% 
  mutate(razo = as.double(razo)) %>% 
  #noga
  mutate(noga = str_extract(notes, "\\d*.gannets")) %>% 
  mutate(noga = str_extract(noga, "\\d*")) %>% 
  mutate(noga = as.double(noga)) %>% 
  #baea
  mutate(baea = str_extract(notes, "\\d*.imm")) %>% 
  mutate(baea = str_extract(baea, "\\d*")) %>% 
  mutate(baea = as.double(baea)) %>%
  #lagu
  mutate(lagu = str_extract(notes, "\\d*.laughing")) %>% 
  mutate(lagu = str_extract(lagu, "\\d*")) %>% 
  mutate(lagu = as.double(lagu)) %>% 
  mutate(herg = as.double(gulls)) %>% 
  mutate(gbbg = as.double(GBBG))

tower_count_2001 <- tower_count_2001 %>% 
  pivot_longer(cols = c(herg, gbbg, COEI, chix, BLGU, dcco, atpu, razo, noga, baea, lagu),
               names_to = "species",
               values_to = "count")


tower_2001_clean <- tower_count_2001 %>% 
  mutate(notes = notes, date = Date) %>% 
  select(date, species, count, notes) %>% 
  mutate(species = case_when(species == "GBBG" ~ "gbbg",
                            species == "HERG" ~ "herg",
                            species == "COEI" ~ "coei_ad",
                            species == "chix" ~ "coei_ju",
                            species == "BLGU" ~ "blgu",
                            species == "puffin" ~ "atpu",
                            TRUE ~ as.character(species)))

ggplot(tower_2001_clean, aes(x = date, y = count, color = species))+
  geom_point()
  
```

```{r}
tower <- rbind(tower_2006_clean, tower_2009_clean, tower_2001_clean)
#use sub string to create a new column extracting the year
```

