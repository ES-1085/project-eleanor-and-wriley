---
title: "Project Work"
author: "Eleanor and Wriley"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(viridis)
library(hrbrthemes)
library(sf)
library(leaflet)
library(gganimate)
library(ggimage)
library(gifski)
library(transformr)
library(forcats)
library(visdat)
```

## R Markdown


##Island Counts over Time
```{r reading in data}
data <- read_csv("data/chickchecktidy2022.csv")
```

```{r reading in data cont}
population_distribution_gulls <- read_xlsx(str_c("data/gull_pop_distribution_2022.xlsx")) 
population_distribution_gulls$West[3]=193 
```

```{r dodged barplot}

#it would be good to split this up into a data tidying section and then the visuals
ggplot(population_distribution_gulls, aes(x = `YEAR`, y = `Total Corrected`)) +
  geom_col()

head(population_distribution_gulls)

population_distribution_gulls$West[3]=193

population_distribution_gulls %>%
  rename(little_point = `Little Point (near Boathouse)`) %>%
  mutate(West = as.numeric(`West`)) %>%
  mutate(south_end = East + West + Extension) %>%
  mutate(north_end = Point + Cabin + Hell) %>%
  select(YEAR, south_end, north_end, Borofsky, little_point) %>%
  pivot_longer( cols = south_end:little_point,
               names_to = "location",
               values_to = "total") %>%
  ggplot(aes(y = total, x = YEAR, fill = location)) +
  geom_col(position = "dodge", stat = "identity") +
   scale_fill_viridis(discrete = T) +
  theme_ipsum()

population_distribution_gulls %>%
  rename(little_point = `Little Point (near Boathouse)`) %>%
  mutate(West = as.numeric(`West`)) %>%
  select(YEAR, East, West, Extension) %>%
  pivot_longer( cols = East:Extension,
               names_to = "location",
               values_to = "total") %>%
  ggplot(aes(y = total, x = YEAR, fill = location)) +
  geom_col(position = "dodge", stat = "identity") +
   scale_fill_viridis(discrete = T) +
  theme_ipsum()
```

```{r filled barplot}
population_distribution_gulls %>%
  rename(little_point = `Little Point (near Boathouse)`) %>%
  mutate(West = as.numeric(`West`)) %>%
  mutate(south_end = East + West + Extension) %>%
  mutate(north_end = Point + Cabin + Hell) %>%
  filter(!is.na(south_end)) %>% 
  select(YEAR, south_end, north_end, Borofsky, little_point) %>%
  pivot_longer( cols = south_end:little_point,
               names_to = "location",
               values_to = "total") %>%
  ggplot(aes(y = total, x = YEAR, fill = location)) +
  geom_col(position = "fill", stat = "identity") +
   scale_fill_viridis(discrete = T) +
  theme_ipsum()
```

##Tower Count Visualization (Eleanor)

see shiny app for others

```{r barplot animation}

tower <- read_csv("data/towerclean.csv")
tower %>%
  filter(!is.na(count)) %>% 
  filter(species == c("herg","coei_ju","coei_ad","gbbg","blgu","puffin")) %>%
  group_by(species, year) %>% 
  summarize(max = max(count)) %>%
  ggplot(aes(x = species, y = max, fill = species))+
  geom_col()+
  transition_states(states = year, 
                    transition_length = 2,
                    state_length = 1)+
    labs(title = 'Year: {frame_time}', 
       x = 'max count', 
       y = 'species')
```

##Colony Distribution Animation

```{r practice leaflet}

gullshape2021 <- read_sf("data/gullshapefiles/gulls2021")
outline <- read_sf("data/outlinecolored")
head(gullshape2021)
plot(gullshape2021)

gullshape2021 <- st_transform(gullshape2021, "+init=epsg:4326")
outline <- st_transform(outline, "+init=epsg:4326")

leaflet(data = gullshape2021) %>% 
  addProviderTiles(providers$Esri.WorldImagery) %>% 
    setView(lng = -68, 
          lat = 44, 
          zoom = 8) %>%
  addPolygons(data = outline) %>% 
  addCircleMarkers()

```


```{r join-shapefile-nestcount}
##2022
gullshape2022 <- read_sf("data/gullshapefiles/Gulls2022")
nest_count_clean_2022 <- read.csv("data/nest_count_clean/nest_count_clean_2022.csv")
gullshape2022 <- st_transform(gullshape2022, "+init=epsg:4326") %>%
  select(Comment, geometry) %>%
  rename(flag = "Comment") %>%
  mutate(flag = as.integer(flag))

gullshape2022 <- gullshape2022 %>%
  full_join(nest_count_clean_2022, by = "flag") %>%
  mutate(year = "2022") %>%
  select(flag, geometry, clutch, year, species)
##2021
gullshape2021 <- read_sf("data/gullshapefiles/Gulls2021")
nest_count_clean_2021 <- read.csv("data/nest_count_clean/nest_count_clean_2021.csv")
gullshape2021 <- st_transform(gullshape2021, "+init=epsg:4326") %>%
  select(Comment, geometry) %>%
  rename(flag = "Comment") %>%
  mutate(flag = as.integer(flag))

gullshape2021 <- gullshape2021 %>%
  full_join(nest_count_clean_2022, by = "flag") %>%
  mutate(year = "2021") %>%
  select(flag, geometry, clutch, year, species)



gullshapetest <- rbind(gullshape2022, gullshape2021)


```

```{r map-just-colony, eval = FALSE, echo = TRUE, fig.height=4, fig.width=4}
ggplot(outline) +
  # geom_sf(data = outline, fill = "lightblue")+
  geom_sf(data = gullshapetest, color = "midnightblue", aes(group = year)) +
  coord_sf(ylim = c(44.140385, 44.145726), xlim = c(-68.25038, -68.242629), expand = FALSE) + 
  transition_states(states = year) +
  #  # ease_aes('linear') +
  theme_bw()

```


  

```{r loading tracking data}

gulltrack <- sometrackingdata <- read_delim("data/sometrackingdata.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)


GUL01 <- gulltrack %>% 
  filter(`Logger ID` == "GUL01")
 
ggplot()+
  geom_path(data = GUL01, aes(x = Longitude, y = Latitude))
```

```{r gull colony size vs gull tower counts}


```



