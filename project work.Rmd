---
title: "Project Work"
author: "Eleanor and Wriley"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(viridis)
library(hrbrthemes)
library(sf)
library(leaflet)
library(gganimate)
library(ggimage)
library(gifski)
```

## R Markdown


##Island Counts over Time
```{r reading in data}
data <- read_csv("data/chickchecktidy2022.csv")
```

```{r reading in data cont}
population_distribution_gulls <- read_xlsx(str_c("data/gull_pop_distribution_2022.xlsx")) 
population_distribution_gulls$West[3]=193 
```

```{r dodged barplot}

#it would be good to split this up into a data tidying section and then the visuals
ggplot(population_distribution_gulls, aes(x = `YEAR`, y = `Total Corrected`)) +
  geom_col()

head(population_distribution_gulls)

population_distribution_gulls$West[3]=193

population_distribution_gulls %>%
  rename(little_point = `Little Point (near Boathouse)`) %>%
  mutate(West = as.numeric(`West`)) %>%
  mutate(south_end = East + West + Extension) %>%
  mutate(north_end = Point + Cabin + Hell) %>%
  select(YEAR, south_end, north_end, Borofsky, little_point) %>%
  pivot_longer( cols = south_end:little_point,
               names_to = "location",
               values_to = "total") %>%
  ggplot(aes(y = total, x = YEAR, fill = location)) +
  geom_col(position = "dodge", stat = "identity") +
   scale_fill_viridis(discrete = T) +
  theme_ipsum()

population_distribution_gulls %>%
  rename(little_point = `Little Point (near Boathouse)`) %>%
  mutate(West = as.numeric(`West`)) %>%
  select(YEAR, East, West, Extension) %>%
  pivot_longer( cols = East:Extension,
               names_to = "location",
               values_to = "total") %>%
  ggplot(aes(y = total, x = YEAR, fill = location)) +
  geom_col(position = "dodge", stat = "identity") +
   scale_fill_viridis(discrete = T) +
  theme_ipsum()
```

```{r filled barplot}
population_distribution_gulls %>%
  rename(little_point = `Little Point (near Boathouse)`) %>%
  mutate(West = as.numeric(`West`)) %>%
  mutate(south_end = East + West + Extension) %>%
  mutate(north_end = Point + Cabin + Hell) %>%
  select(YEAR, south_end, north_end, Borofsky, little_point) %>%
  pivot_longer( cols = south_end:little_point,
               names_to = "location",
               values_to = "total") %>%
  ggplot(aes(y = total, x = YEAR, fill = location)) +
  geom_col(position = "fill", stat = "identity") +
   scale_fill_viridis(discrete = T) +
  theme_ipsum()
```


##Tower Count Visualization (Eleanor)


##Colony Distribution Animation

```{r practice leaflet}

gullshape2021 <- read_sf("data/gullshapefiles/gulls2021")
outline <- read_sf("data/outlinecolored")
head(gullshape2021)
plot(gullshape2021)

gullshape2021 <- st_transform(gullshape2021, "+init=epsg:4326")
outline <- st_transform(outline, "+init=epsg:4326")

leaflet(data = gullshape2021) %>% 
  addProviderTiles(providers$Esri.WorldImagery) %>% 
    setView(lng = -68, 
          lat = 44, 
          zoom = 8) %>%
  addPolygons(data = outline) %>% 
  addCircleMarkers()

```


```{r join-shapefile-nestcount}
##2022
gullshape2022 <- read_sf("data/gullshapefiles/Gulls2022")
nest_count_clean_2022 <- read.csv("data/nest_count_clean_2022.csv")
gullshape2022 <- st_transform(gullshape2022, "+init=epsg:4326") %>%
  select(Comment, geometry) %>%
  rename("Flag" = "Comment") %>%
  mutate(Flag = as.integer(Flag))

gullshape2022 %>%
  full_join(nest_count_clean_2022, by = "Flag")
##2021

nest_count_clean_2021 <- read.csv("data/nest_count_clean_2021.csv")
gullshape2021 <- select(Comment, geometry)


```

```{r eval = FALSE, echo = TRUE, fig.height=4, fig.width=4}
ggplot(outline) +
  geom_sf(data = outline, fill = "lightblue")+
  geom_sf(data = gullshape2021, color = "midnightblue") +
  coord_sf(ylim = c(44.140385, 44.145726), xlim = c(-68.25038, -68.242629), expand = FALSE) + 
  theme_bw()

```

```{r fun tower times}
towerclean <- read_csv("data/towerclean.csv")

towerclean %>%  
  group_by(species) %>% 
  summarize(max = max(count)) %>%
  filter(max >= 5) %>% 
  ggplot(aes( y = species, x = max, fill = species))+
  geom_col()+
  scale_fill_viridis_d()+
  labs(main = "Species High Counts")
  

```

```{r}

GUL01 <- gulltrack %>% 
  filter(`Logger ID` == "GUL01")
 
ggplot()+
  geom_path(data = GUL01, aes(x = Longitude, y = Latitude))+
  geom_sf(data = outline, fill = "lightblue")+
  coord_sf(ylim = c(44.5, 45), xlim = c(-68.1, -68.4), expand = FALSE)
```

```{r}

pop_dist_clean <- population_distribution_gulls %>%
  rename(little_point = `Little Point (near Boathouse)`) %>%
  mutate(West = as.numeric(`West`)) %>%
  mutate(south_end = East + West + Extension) %>%
  mutate(north_end = Point + Cabin + Hell) %>%
  select(YEAR, south_end, north_end, Borofsky, little_point) %>%
  pivot_longer( cols = south_end:little_point,
               names_to = "location",
               values_to = "total") %>% 
  filter(location == "south_end") %>% 
  mutate(year = as.character(YEAR))

towerclean %>%
  mutate(year = as.character(year)) %>% 
  filter(species == "herg") %>% 
  group_by(year) %>% 
  mutate(year = as.character(year)) %>% 
  ggplot()+
  geom_boxplot(aes(x = year, y = count))+
  geom_point(data = pop_dist_clean, aes(x = year, y = total), color = "aquamarine4")
```

```{r}
towerclean %>%
  filter(species == c("herg","gbbg","coei_ad","blgu")) %>%
  mutate(year = as.character(year)) %>% 
  group_by(year, species) %>% 
  ggplot(aes(x = count, y = year, fill = species))+
  geom_col(position = "dodge")
  

```

```{r}
se <- function(x) sd(x)/sqrt(length(x))
towerclean %>% 
  filter(species == c("herg","gbbg","blgu")) %>%
  filter(year == 2022) %>% 
  group_by(species, year) %>% 
  summarize(mean = mean(count), se = se(count)) %>% 
  ggplot(aes(x = species, y = mean, fill = species))+
  geom_col()+
  geom_errorbar(aes(x = species, ymin = (mean - se), ymax = (mean + se)), size = 1, width = 0.3, alpha = 0.5)
  
```

```{r}
gulls2000 <- towerclean %>% 
  filter(species == "herg", year == 2000)

gulls2022 <- towerclean %>% 
  filter(species == "herg", year == 2022)

boxplot(gulls2022$count, gulls2000$count)


t <- t.test(gulls2000$count, gulls2022$count)
t

```

```{r}
towerclean %>%
  filter(count > 0) %>% 
  group_by(year) %>% 
  summarize(n = length(unique(species)))
```
```{r}

blgus2000 <- towerclean %>% 
  filter(species == "blgu", year == 2000)

blgus2022 <- towerclean %>% 
  filter(species == "blgu", year == 2022)


t <- t.test(blgus2000$count, blgus2022$count)
t

```


